#!/bin/bash

set -x

true "$0"

MYDIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

cd "$MYDIR"
cd ..
cd help-steps

source variables
source pre

create-debian-img() {
   trap "error_handler_general" ERR INT TERM

   mkdir --parents /home/"$USERNAME"/whonix_binary/

   ## vmsize 100 GB does not matter because only space,
   ## which gets actually filled up, will take disk space.

   grml-debootstrap \
      --arch i386 \
      --filesystem ext4 \
      --force \
      --hostname host \
      --mirror http://127.0.0.1:3142/debian \
      --keep_src_list \
      --password changeme \
      --release wheezy \
      --verbose \
      --vmfile \
      --vmsize "100G" \
      --config ""$WHONIX_SOURCE_FOLDER"/grml_config" \
      --packages ""$WHONIX_SOURCE_FOLDER"/"$VMNAME"_packages" \
      --target /home/"$USERNAME"/whonix_binary/"$VMNAME".img

   chown --recursive user:user /home/"$USERNAME"/whonix_binary/
} 

create-debian-img

