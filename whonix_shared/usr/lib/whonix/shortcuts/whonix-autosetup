#!/bin/bash

## This file is part of Whonix.
## Copyright (C) 2012 - 2014 Patrick Schleizer <adrelanos@riseup.net>
## See the file COPYING for copying conditions.

set -x

if [ -f "/usr/share/whonix/whonix_workstation" ]; then
   ## There is an /etc/sudoers.d/ exception.
   sudo /usr/lib/whonix/whonix_repo_r_config_exists
   ret="$?"
   if [ "$ret" = "0" ]; then
      ## /root/.whonix.d/35_aptrepository_autogenerated exists.
      exit 0
   elif [ "$ret" = "1" ]; then
      ## /root/.whonix.d/35_aptrepository_autogenerated does not exist.
      cat /etc/motd
      sudo whonixsetup
      true "Feel free to close this window."
      sleep 86400
      exit 0
   else
      ## Unexpected return code.
      true "Please report this Whonix bug!"
      true "Feel free to close this window."
      sleep 86400
      exit 1
   fi
fi

source /usr/lib/whonix/whonixcheck/17_check_tor_enabled

## Check if Tor is enabled.
## returns: TOR_ENABLED
check_tor_enabled_do

if [ "$TOR_ENABLED" = "0" ]; then
   cat /etc/motd
   sudo whonixsetup
   true "Feel free to close this window."
   sleep 86400
   exit 0
fi

exit 0
