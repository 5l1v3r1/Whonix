#!/bin/bash

cleanup() {
   trap "error_handler" ERR

   true "cleanup function..."
     
   cd ..
   if [ -d "$VERIFY_TEMPDIR" ]; then
      rm -r "$VERIFY_TEMPDIR"
   fi

   if [ "$SHOW_CLI" = "1" ]; then
      true
   elif [ "$SHOW_X" = "1" ]; then
      true
   else
      progress_bar 100
   fi   
   
   sync
   
   if [ "$SHOW_CLI" = "1" ]; then
      true
   elif [ "$SHOW_X" = "1" ]; then
      true
   else  
      rm -f /var/run/whonix/whonixcheck/""$SCRIPTNAME"_running"
      rm -f /var/run/whonix/whonixcheck/""$SCRIPTNAME"_waiting"
      rm -f /var/run/whonix/whonixcheck/"$SCRIPTNAME"_progress
      touch /var/run/whonix/whonixcheck/""$SCRIPTNAME"_done"      
   fi
   
   sync
   
   ## Close pipe, which was opened for zenity.
   #exec 3>&- || true
  
   show_output
   
   progress_bar 100
   rm -f /var/run/whonix/whonixcheck/"$SCRIPTNAME"_progress
   
   ## default exit code
   if [ "$EXIT_CODE" = "" ]; then
      EXIT_CODE="0"
   fi
   
   exit "$EXIT_CODE"
}

