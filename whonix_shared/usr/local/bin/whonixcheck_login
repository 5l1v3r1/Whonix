#!/bin/bash

## Whonix /usr/local/bin/whonixcheck_login

## Gets run by /etc/profile.d/whonixcheck.sh

## Not using on Whonix-Workstation,
## because /home/user/.config/autostart/whonixcheck.desktop
## does a better job.
if [ -f "/usr/local/share/whonix/whonix_workstation" ]; then
   exit 0
fi

## Random delay between 0 and 500 seconds.
DELAY="$(( 100+(`od -An -N2 -i /dev/random` )%(300-0+1) ))"

## 60 seconds minimum delay.
DELAY="`expr "$DELAY" + "60"`" || true

## For debugging.
#DELAY="10"

echo "Starting whonixcheck in "$DELAY" seconds..."

sleep "$DELAY"

whonixcheck -autostart

## End of Whonix /usr/local/bin/whonixcheck_login