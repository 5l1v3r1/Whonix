#!/bin/bash

# This file is part of Whonix
# Copyright (C) 2012 - 2013 adrelanos <adrelanos at riseup dot net>
# See the file COPYING for copying conditions.

source /usr/share/whonix/postinst.d/pre.bsh

## {{ Get rid of old scripts.

rm --force /etc/profile.d/30_timesync
rm --force /etc/profile.d/40_whonixcheck
rm --force /etc/profile.d/80_desktop.sh

## }}

## {{ first run initializer

skip_first_run_initializer="0"

if [ ! -f "/usr/share/whonix/build_version" ]; then
   ## Earlier versions than 137adretemp had no build_version file.
   skip_first_run_initializer="1"
else
   build_version="$(cat "/usr/share/whonix/build_version")"
fi

if [ "$build_version" = "137adretemp" ]; then
   skip_first_run_initializer="1"
fi

if [ "$build_version" = "6" ]; then
   skip_first_run_initializer="1"
fi

if [ "$build_version" = "6.1" ]; then
   skip_first_run_initializer="1"
fi

if [ "$build_version" = "6.2" ]; then
   skip_first_run_initializer="1"
fi

if [ "$build_version" = "7" ]; then
   skip_first_run_initializer="1"
fi

if [ "$build_version" = "7.3.3" ]; then
   skip_first_run_initializer="1"
fi

if [ "$build_version" = "7.3.7" ]; then
   skip_first_run_initializer="1"
fi

if [ "$build_version" = "7.3.8" ]; then
   skip_first_run_initializer="1"
fi

if [ "$skip_first_run_initializer" = "1" ]; then
   done_file=~/.whonix/first_run_initializer.done
   legacy_file=~/.whonix/first_run_initializer.legacy

   sudo -u user mkdir --parents ~/.whonix/
   sudo -u user touch "$done_file"
   sudo -u user touch "$legacy_file"
fi

## }}
