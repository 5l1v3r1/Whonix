#!/bin/bash

# Debugging.
#set-x

set -e

# Check if we are root
if [ "$(id -u)" != "0" ]; then
  echo "leaktest: This script must be run as root (sudo)"
  exit 1
fi

echo "Running apt-get update..."
apt-get update

echo "leaktest: Installing python-scapy, if it is not installed yet."
# Install scapy to the aos-Workstation for Leak Testing.
apt-get --yes install python-scapy

echo "leaktest: Starting leak test, hit ctrl+c to abort..."
echo "leaktest: Make sure leaktest is already running on aos-Gateway."

echo "leaktest: python /usr/share/leaktest/exhaustive_ip_send.py..."
python /usr/share/leaktest/exhaustive_ip_send.py
echo "leaktest: python /usr/share/leaktest/tcp_test.py..."
python /usr/share/leaktest/tcp_test.py
echo "leaktest: python /usr/share/leaktest/udp_test.py..."
python /usr/share/leaktest/udp_test.py

echo "leaktest: You may uninstall python-scapy manually using:"
echo "          sudo apt-get remove python-scapy"
echo "leaktest: Leaktest finished."
echo "leaktest: See aos/LeakTestsOld on instructions how to interpret the results."